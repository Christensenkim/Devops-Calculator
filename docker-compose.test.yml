version: "3.3"

services:
    app-database:
        image: mysql
        restart: always
        environment: 
            MYSQL_ROOT_PASSWORD: Adm1npassword
            MYSQL_DATABASE: CalculationsDB
        ports:
            - 33306:3306
        volumes:
            - ./db/data:/var/lib/mysql

        flyway:
            image: flyway/flyway
            command: migrate
            volumes:
                - ./db:/flyway/sql
                - ./db:/flyway/conf
            depends_on: 
                - app-database
                
    frontend:
        image: christensenkim/devopscalc-web:${BUILD_NUMBER}
        environment: 
            ASPNETCORE_ENVIRONMENT: Test
        ports: 
            - 25002:80

    application:
        image: christensenkim/devopscalc:${BUILD_NUMBER}
        environment: 
            ASPNETCORE_ENVIRONMENT: Test
        ports: 
            - 25001:80